<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Políticas - Amazonia Concrete</title>
    <style>
        :root {
            color-scheme: light;
            font-size: 16px;
            --green-900: #1c2e1b;
            --green-800: #284428;
            --green-600: #3f5c3d;
            --green-400: #6f8e6c;
            --green-200: #dfe7dc;
            --yellow-500: #f6c343;
            --bg: #f3f5f1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--green-900);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #20321f, #456642);
            color: white;
            padding: 3rem 1rem 4rem;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
        }

        header::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.2), transparent 55%);
            opacity: 0.8;
            pointer-events: none;
        }

        .header-inner {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 2rem;
            align-items: center;
        }

        .logo-panel {
            background: rgba(255,255,255,0.12);
            border-radius: 24px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            min-height: 240px;
            justify-content: center;
        }

        .logo-panel img {
            width: 180px;
            height: auto;
            filter: drop-shadow(0 10px 25px rgba(0,0,0,0.35));
        }

        .header-copy h1 {
            font-size: clamp(2rem, 4vw, 3.2rem);
            letter-spacing: 1px;
        }

        .header-copy p {
            opacity: 0.9;
            margin-top: 0.75rem;
        }

        .quick-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1.5rem;
        }

        .quick-links a {
            padding: 0.5rem 1.25rem;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.45);
            color: white;
            text-decoration: none;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            font-size: 0.85rem;
            transition: background 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
        }

        .quick-links a:hover,
        .quick-links a:focus-visible {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            border-color: white;
        }

        main {
            max-width: 1200px;
            margin: -60px auto 3rem;
            padding: 0 1.5rem;
        }

        .card {
            background: #fff;
            border-radius: 28px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            border: 1px solid rgba(33, 57, 33, 0.08);
        }

        .card h2 {
            margin-bottom: 1rem;
            font-size: 1.6rem;
        }

        .grid-two {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
        }

        label {
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: var(--green-600);
            display: block;
            margin-bottom: 0.35rem;
        }

        input,
        textarea,
        select {
            width: 100%;
            border-radius: 14px;
            border: 1px solid rgba(0,0,0,0.08);
            padding: 0.8rem 1rem;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--green-400);
            box-shadow: 0 0 0 3px rgba(111, 142, 108, 0.2);
        }

        .policy-card {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            align-items: flex-start;
        }

        .policy-header {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .policy-header span {
            font-size: 0.85rem;
            letter-spacing: 0.1em;
            color: var(--green-400);
            text-transform: uppercase;
        }

        .switch {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            margin-top: 0.4rem;
        }

        .switch input {
            width: 0;
            height: 0;
            opacity: 0;
            position: absolute;
        }

        .switch-slider {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--green-200);
            border-radius: 999px;
            transition: background 0.2s ease;
        }

        .switch-slider::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .switch input:checked + .switch-slider {
            background: var(--yellow-500);
        }

        .switch input:checked + .switch-slider::after {
            transform: translateX(24px);
        }

        .preview {
            background: linear-gradient(135deg, rgba(111,142,108,0.08), rgba(111,142,108,0.18));
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px dashed rgba(52, 76, 51, 0.2);
        }

        .preview h4 {
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }

        .preview ul {
            margin-top: 0.75rem;
            padding-left: 1.2rem;
        }

        .preview li + li {
            margin-top: 0.35rem;
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            font-size: 0.95rem;
        }

        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        button {
            border: none;
            border-radius: 14px;
            padding: 0.9rem 1.4rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-primary {
            background: var(--green-600);
            color: white;
            box-shadow: 0 10px 25px rgba(63,92,61,0.35);
        }

        .btn-secondary {
            background: white;
            color: var(--green-600);
            border: 1px solid rgba(63,92,61,0.35);
        }

        button:hover,
        button:focus-visible {
            transform: translateY(-2px);
        }

        @media (max-width: 640px) {
            .card {
                padding: 1.5rem;
            }

            .preview {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-inner">
            <div class="logo-panel">
                <img id="company-logo" src="images/logo.webp" alt="Logo de Amazonia Concrete" onerror="this.src='images/logo.webp'">
                <p>Personaliza la imagen agregando tu propia URL en la sección de configuración.</p>
            </div>
            <div class="header-copy">
                <p class="eyebrow">Centro de configuración</p>
                <h1>Políticas corporativas</h1>
                <p>Actualiza desde un mismo lugar la información clave de tus políticas de envío, reembolso, privacidad y cualquier otra directriz interna.</p>
                <div class="meta">
                    <span id="company-name-display">Amazonia Concrete</span>
                    <span id="last-update-display">Actualizado: 2024-01-01</span>
                </div>
                <div class="quick-links">
                    <a href="#envios">Política de envíos</a>
                    <a href="#reembolsos">Política de reembolso</a>
                    <a href="#privacidad">Política de privacidad</a>
                    <a href="#extras">Otras políticas</a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="card" aria-labelledby="general-config-title">
            <div class="policy-header">
                <span>Panel principal</span>
                <h2 id="general-config-title">Configuración general</h2>
            </div>
            <p>Completa estos campos para mostrar tu marca y datos de contacto en cada política.</p>
            <div class="grid-two" style="margin-top: 1.5rem;">
                <div>
                    <label for="company-name">Nombre comercial</label>
                    <input id="company-name" type="text" data-general-field="companyName" placeholder="Amazonia Concrete">
                </div>
                <div>
                    <label for="contact-email">Correo de contacto</label>
                    <input id="contact-email" type="email" data-general-field="contactEmail" placeholder="info@amazonia.com">
                </div>
                <div>
                    <label for="contact-phone">Teléfono</label>
                    <input id="contact-phone" type="tel" data-general-field="contactPhone" placeholder="(+57) 320 000 0000">
                </div>
                <div>
                    <label for="last-update">Fecha de actualización</label>
                    <input id="last-update" type="date" data-general-field="lastUpdate">
                </div>
                <div>
                    <label for="logo-url">URL del logo</label>
                    <input id="logo-url" type="url" data-general-field="logoUrl" placeholder="https://tuservidor.com/logo.svg">
                </div>
                <div>
                    <label for="global-note">Nota general</label>
                    <textarea id="global-note" rows="4" data-general-field="globalNote" placeholder="Describe aquí cualquier aclaración que se repetirá en todas las políticas."></textarea>
                </div>
            </div>
            <div class="button-row">
                <button class="btn-secondary" type="button" id="reset-config">Restablecer</button>
                <button class="btn-primary" type="button" id="save-config">Guardar cambios</button>
            </div>
        </section>

        <section class="card" id="envios">
            <div class="policy-card" data-policy="shipping">
                <div>
                    <div class="policy-header">
                        <span>Operaciones</span>
                        <h2>Política de envíos</h2>
                        <label class="switch">
                            <input type="checkbox" data-policy-field="active">
                            <span class="switch-slider" aria-hidden="true"></span>
                            <strong>Mostrar en el sitio</strong>
                        </label>
                    </div>
                    <div style="margin-top: 1.2rem; display: grid; gap: 1.2rem;">
                        <div>
                            <label for="shipping-summary">Resumen</label>
                            <textarea id="shipping-summary" data-policy-field="summary" placeholder="Describe los plazos de envío y las zonas cubiertas."></textarea>
                        </div>
                        <div class="grid-two">
                            <div>
                                <label for="shipping-sla">Tiempo estimado</label>
                                <input id="shipping-sla" type="text" data-policy-field="sla" placeholder="3 - 5 días hábiles">
                            </div>
                            <div>
                                <label for="shipping-coverage">Cobertura</label>
                                <input id="shipping-coverage" type="text" data-policy-field="coverage" placeholder="Todo el territorio nacional">
                            </div>
                            <div>
                                <label for="shipping-cost">Costo base</label>
                                <input id="shipping-cost" type="text" data-policy-field="cost" placeholder="Envíos gratis desde $300.000">
                            </div>
                            <div>
                                <label for="shipping-contact">Contacto logístico</label>
                                <input id="shipping-contact" type="text" data-policy-field="contact" placeholder="logistica@amazonia.com">
                            </div>
                        </div>
                        <div>
                            <label for="shipping-details">Detalles</label>
                            <textarea id="shipping-details" data-policy-field="details" placeholder="Incluye empaques especiales, entregas programadas, restricciones, etc."></textarea>
                        </div>
                        <div>
                            <label for="shipping-points">Puntos destacados (uno por línea)</label>
                            <textarea id="shipping-points" data-policy-field="points" placeholder="Seguimiento en línea\nNotificación por SMS\nEntregas neutras en carbono"></textarea>
                        </div>
                    </div>
                </div>
                <div class="preview">
                    <h4>Vista previa</h4>
                    <p data-policy-preview="shipping"></p>
                    <ul data-policy-points="shipping"></ul>
                    <p class="meta" style="flex-direction: column; gap: 0.3rem;">
                        <span data-policy-meta="shipping"></span>
                        <span data-global-note></span>
                    </p>
                </div>
            </div>
        </section>

        <section class="card" id="reembolsos">
            <div class="policy-card" data-policy="refund">
                <div>
                    <div class="policy-header">
                        <span>Clientes</span>
                        <h2>Política de reembolso</h2>
                        <label class="switch">
                            <input type="checkbox" data-policy-field="active">
                            <span class="switch-slider" aria-hidden="true"></span>
                            <strong>Mostrar en el sitio</strong>
                        </label>
                    </div>
                    <div style="margin-top: 1.2rem; display: grid; gap: 1.2rem;">
                        <div>
                            <label for="refund-summary">Resumen</label>
                            <textarea id="refund-summary" data-policy-field="summary" placeholder="Explica quién aplica para reembolso y los plazos."></textarea>
                        </div>
                        <div class="grid-two">
                            <div>
                                <label for="refund-window">Ventana de solicitud</label>
                                <input id="refund-window" type="text" data-policy-field="window" placeholder="15 días desde la entrega">
                            </div>
                            <div>
                                <label for="refund-method">Método de reembolso</label>
                                <input id="refund-method" type="text" data-policy-field="method" placeholder="Transferencia bancaria / Nota crédito">
                            </div>
                            <div>
                                <label for="refund-contact">Contacto</label>
                                <input id="refund-contact" type="text" data-policy-field="contact" placeholder="servicio@amazonia.com">
                            </div>
                            <div>
                                <label for="refund-requirements">Requisitos</label>
                                <input id="refund-requirements" type="text" data-policy-field="requirements" placeholder="Factura, evidencia fotográfica">
                            </div>
                        </div>
                        <div>
                            <label for="refund-details">Detalles</label>
                            <textarea id="refund-details" data-policy-field="details" placeholder="Condiciones especiales, productos sin reembolso, pasos del proceso."></textarea>
                        </div>
                        <div>
                            <label for="refund-points">Puntos destacados</label>
                            <textarea id="refund-points" data-policy-field="points" placeholder="Evaluación en 48h\nNotificación automática\nCobertura nacional"></textarea>
                        </div>
                    </div>
                </div>
                <div class="preview">
                    <h4>Vista previa</h4>
                    <p data-policy-preview="refund"></p>
                    <ul data-policy-points="refund"></ul>
                    <p class="meta" style="flex-direction: column; gap: 0.3rem;">
                        <span data-policy-meta="refund"></span>
                        <span data-global-note></span>
                    </p>
                </div>
            </div>
        </section>

        <section class="card" id="privacidad">
            <div class="policy-card" data-policy="privacy">
                <div>
                    <div class="policy-header">
                        <span>Confidencialidad</span>
                        <h2>Política de privacidad</h2>
                        <label class="switch">
                            <input type="checkbox" data-policy-field="active">
                            <span class="switch-slider" aria-hidden="true"></span>
                            <strong>Mostrar en el sitio</strong>
                        </label>
                    </div>
                    <div style="margin-top: 1.2rem; display: grid; gap: 1.2rem;">
                        <div>
                            <label for="privacy-summary">Resumen</label>
                            <textarea id="privacy-summary" data-policy-field="summary" placeholder="Describe cómo recolectan, utilizan y protegen la información."></textarea>
                        </div>
                        <div class="grid-two">
                            <div>
                                <label for="privacy-usage">Uso de datos</label>
                                <input id="privacy-usage" type="text" data-policy-field="usage" placeholder="Procesar pedidos, analítica interna">
                            </div>
                            <div>
                                <label for="privacy-storage">Tiempo de almacenamiento</label>
                                <input id="privacy-storage" type="text" data-policy-field="storage" placeholder="5 años o según la ley">
                            </div>
                            <div>
                                <label for="privacy-shared">Terceros autorizados</label>
                                <input id="privacy-shared" type="text" data-policy-field="shared" placeholder="Pasarelas de pago, transporte">
                            </div>
                            <div>
                                <label for="privacy-contact">Oficial de datos</label>
                                <input id="privacy-contact" type="text" data-policy-field="contact" placeholder="datos@amazonia.com">
                            </div>
                        </div>
                        <div>
                            <label for="privacy-details">Detalles</label>
                            <textarea id="privacy-details" data-policy-field="details" placeholder="Derechos ARCO, mecanismos de revocatoria, bases legales."></textarea>
                        </div>
                        <div>
                            <label for="privacy-points">Puntos destacados</label>
                            <textarea id="privacy-points" data-policy-field="points" placeholder="Infraestructura certificada\nCifrado punto a punto\nAuditorías anuales"></textarea>
                        </div>
                    </div>
                </div>
                <div class="preview">
                    <h4>Vista previa</h4>
                    <p data-policy-preview="privacy"></p>
                    <ul data-policy-points="privacy"></ul>
                    <p class="meta" style="flex-direction: column; gap: 0.3rem;">
                        <span data-policy-meta="privacy"></span>
                        <span data-global-note></span>
                    </p>
                </div>
            </div>
        </section>

        <section class="card" id="extras">
            <div class="policy-card" data-policy="extra">
                <div>
                    <div class="policy-header">
                        <span>Complementos</span>
                        <h2>Otras políticas internas</h2>
                        <label class="switch">
                            <input type="checkbox" data-policy-field="active">
                            <span class="switch-slider" aria-hidden="true"></span>
                            <strong>Mostrar en el sitio</strong>
                        </label>
                    </div>
                    <div style="margin-top: 1.2rem; display: grid; gap: 1.2rem;">
                        <div>
                            <label for="extra-title">Nombre de la política</label>
                            <input id="extra-title" type="text" data-policy-field="customTitle" placeholder="Política ambiental, garantía extendida, etc.">
                        </div>
                        <div>
                            <label for="extra-summary">Resumen</label>
                            <textarea id="extra-summary" data-policy-field="summary" placeholder="Describe el objetivo de la política seleccionada."></textarea>
                        </div>
                        <div class="grid-two">
                            <div>
                                <label for="extra-owner">Responsable</label>
                                <input id="extra-owner" type="text" data-policy-field="owner" placeholder="Gerencia de calidad">
                            </div>
                            <div>
                                <label for="extra-scope">Ámbito</label>
                                <input id="extra-scope" type="text" data-policy-field="scope" placeholder="Plantas productivas, oficinas, etc.">
                            </div>
                        </div>
                        <div>
                            <label for="extra-details">Detalles</label>
                            <textarea id="extra-details" data-policy-field="details" placeholder="Procedimientos, métricas, requisitos regulatorios."></textarea>
                        </div>
                        <div>
                            <label for="extra-points">Puntos destacados</label>
                            <textarea id="extra-points" data-policy-field="points" placeholder="Capacitaciones trimestrales\nReportes automáticos\nPlanes de mejora continua"></textarea>
                        </div>
                    </div>
                </div>
                <div class="preview">
                    <h4>Vista previa</h4>
                    <p data-policy-preview="extra"></p>
                    <ul data-policy-points="extra"></ul>
                    <p class="meta" style="flex-direction: column; gap: 0.3rem;">
                        <span data-policy-meta="extra"></span>
                        <span data-global-note></span>
                    </p>
                </div>
            </div>
        </section>
    </main>

    <script>
        const defaultState = {
            companyName: 'Amazonia Concrete',
            contactEmail: 'contacto@amazonia.com',
            contactPhone: '+57 320 000 0000',
            lastUpdate: '2024-01-01',
            logoUrl: 'images/logo.webp',
            globalNote: 'Todas nuestras políticas se apegan al marco regulatorio colombiano y se actualizan de forma periódica.',
            policies: {
                shipping: {
                    active: true,
                    summary: 'Enviamos cada pedido con embalaje reforzado y seguimiento en tiempo real para garantizar entregas seguras.',
                    sla: '3 a 5 días hábiles',
                    coverage: 'Cobertura nacional con aliados certificados',
                    cost: 'Sin costo para compras superiores a $300.000',
                    contact: 'logistica@amazonia.com',
                    details: 'Coordinamos entregas programadas y ofrecemos retiros en planta bajo cita previa. Las zonas especiales pueden requerir tiempos adicionales.',
                    points: 'Seguimiento proactivo\nMensajería directa con el transportista\nCompensación por demoras'
                },
                refund: {
                    active: true,
                    summary: 'Buscamos soluciones rápidas y transparentes para cada solicitud de devolución o reembolso.',
                    window: '15 días calendario posteriores a la entrega',
                    method: 'Transferencia bancaria o saldo a favor',
                    contact: 'servicio@amazonia.com',
                    requirements: 'Factura y evidencia del estado del producto',
                    details: 'Los reembolsos se aprueban tras una inspección técnica. Productos personalizados o usados fuera de especificación no aplican.',
                    points: 'Respuesta inicial en 24 horas\nRecolección sin costo\nReportes automatizados para auditoría'
                },
                privacy: {
                    active: true,
                    summary: 'Protegemos la información de nuestros clientes mediante procesos seguros y transparentes.',
                    usage: 'Gestión comercial, despachos y comunicaciones internas',
                    storage: 'Al menos 5 años o según normativa vigente',
                    shared: 'Transportistas, pasarelas de pago y aliados de servicio',
                    contact: 'datos@amazonia.com',
                    details: 'Aplicamos los principios de legalidad, finalidad y confidencialidad. Los titulares pueden ejercer sus derechos de acceso, corrección o eliminación en cualquier momento.',
                    points: 'Infraestructura alojada en Colombia\nProtocolos de cifrado AES-256\nEvaluaciones anuales de cumplimiento'
                },
                extra: {
                    active: false,
                    customTitle: 'Política ambiental',
                    summary: 'Minimizamos el impacto ambiental con procesos eficientes y trazables.',
                    owner: 'Gerencia HSE',
                    scope: 'Operaciones industriales y cadena logística',
                    details: 'Monitoreamos consumos energéticos, promovemos reciclaje y neutralizamos emisiones con proveedores certificados.',
                    points: 'Metas de reducción del 20%\nAuditorías externas\nReportes trimestrales'
                }
            }
        };

        const STORAGE_KEY = 'amazoniaPoliciesConfig';
        let state = loadState();

        function loadState() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    return mergeDeep(JSON.parse(JSON.stringify(defaultState)), parsed);
                }
            } catch (error) {
                console.warn('No se pudo cargar la configuración guardada', error);
            }
            return JSON.parse(JSON.stringify(defaultState));
        }

        function mergeDeep(target, source) {
            if (!source) return target;
            for (const key of Object.keys(source)) {
                if (typeof source[key] === 'object' && source[key] !== null && !Array.isArray(source[key])) {
                    if (!target[key]) target[key] = {};
                    mergeDeep(target[key], source[key]);
                } else {
                    target[key] = source[key];
                }
            }
            return target;
        }

        const generalInputs = document.querySelectorAll('[data-general-field]');
        const policySections = document.querySelectorAll('[data-policy]');

        function applyStateToInputs() {
            generalInputs.forEach(input => {
                const field = input.dataset.generalField;
                if (field in state) {
                    input.value = state[field] || '';
                }
            });

            policySections.forEach(section => {
                const policyId = section.dataset.policy;
                const policyState = state.policies[policyId];
                if (!policyState) return;
                const inputs = section.querySelectorAll('[data-policy-field]');
                inputs.forEach(input => {
                    const field = input.dataset.policyField;
                    if (field in policyState) {
                        if (input.type === 'checkbox') {
                            input.checked = Boolean(policyState[field]);
                        } else {
                            input.value = policyState[field] || '';
                        }
                    } else if (input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
            });
        }

        function updateGeneralUI() {
            document.getElementById('company-name-display').textContent = state.companyName || 'Nombre de la compañía';
            document.getElementById('last-update-display').textContent = `Actualizado: ${state.lastUpdate || 'sin fecha'}`;
            document.querySelectorAll('[data-global-note]').forEach(span => {
                span.textContent = state.globalNote || '';
            });
            const logo = document.getElementById('company-logo');
            logo.src = state.logoUrl || 'images/logo.webp';
        }

        function formatPreview(policy) {
            const company = state.companyName || 'la compañía';
            let text = policy.summary || 'Completa la información para mostrar esta política.';
            const metaParts = [];
            if (policy.sla) metaParts.push(`Tiempo: ${policy.sla}`);
            if (policy.coverage) metaParts.push(`Cobertura: ${policy.coverage}`);
            if (policy.cost) metaParts.push(`Costo: ${policy.cost}`);
            if (policy.contact) metaParts.push(`Contacto: ${policy.contact}`);
            if (policy.window) metaParts.push(`Ventana: ${policy.window}`);
            if (policy.method) metaParts.push(`Método: ${policy.method}`);
            if (policy.requirements) metaParts.push(`Requisitos: ${policy.requirements}`);
            if (policy.usage) metaParts.push(`Uso: ${policy.usage}`);
            if (policy.storage) metaParts.push(`Retención: ${policy.storage}`);
            if (policy.shared) metaParts.push(`Terceros: ${policy.shared}`);
            if (policy.owner) metaParts.push(`Responsable: ${policy.owner}`);
            if (policy.scope) metaParts.push(`Ámbito: ${policy.scope}`);
            if (policy.details) text += ` ${policy.details}`;
            if (policy.customTitle) text = `${policy.customTitle} — ${text}`;
            return { text: `${company} informa: ${text}`, meta: metaParts.join(' · ') };
        }

        function updatePreviews() {
            policySections.forEach(section => {
                const policyId = section.dataset.policy;
                const policyState = state.policies[policyId];
                if (!policyState) return;
                const preview = section.querySelector(`[data-policy-preview="${policyId}"]`);
                const list = section.querySelector(`[data-policy-points="${policyId}"]`);
                const meta = section.querySelector(`[data-policy-meta="${policyId}"]`);
                const { text, meta: metaText } = formatPreview(policyState);
                preview.textContent = text;
                meta.textContent = metaText;
                list.innerHTML = '';
                if (policyState.points) {
                    policyState.points.split('\n').filter(Boolean).forEach(point => {
                        const li = document.createElement('li');
                        li.textContent = point.trim();
                        list.appendChild(li);
                    });
                }
                if (!policyState.active) {
                    preview.style.opacity = 0.5;
                    list.style.opacity = 0.5;
                    meta.style.opacity = 0.5;
                } else {
                    preview.style.opacity = 1;
                    list.style.opacity = 1;
                    meta.style.opacity = 1;
                }
            });
        }

        function persistState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            } catch (error) {
                console.warn('No se pudo guardar la configuración', error);
            }
        }

        generalInputs.forEach(input => {
            input.addEventListener('input', () => {
                const field = input.dataset.generalField;
                state[field] = input.value;
                updateGeneralUI();
            });
        });

        policySections.forEach(section => {
            section.addEventListener('input', event => {
                const input = event.target;
                if (!input.matches('[data-policy-field]')) return;
                const policyId = section.dataset.policy;
                const field = input.dataset.policyField;
                if (!state.policies[policyId]) state.policies[policyId] = {};
                state.policies[policyId][field] = input.type === 'checkbox' ? input.checked : input.value;
                updatePreviews();
            });
        });

        document.getElementById('save-config').addEventListener('click', () => {
            persistState();
            alert('Configuración guardada correctamente.');
        });

        document.getElementById('reset-config').addEventListener('click', () => {
            if (!confirm('¿Deseas restablecer todas las políticas al valor predeterminado?')) return;
            state = JSON.parse(JSON.stringify(defaultState));
            applyStateToInputs();
            updateGeneralUI();
            updatePreviews();
            persistState();
        });

        applyStateToInputs();
        updateGeneralUI();
        updatePreviews();
    </script>
</body>
</html>
